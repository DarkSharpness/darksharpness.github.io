<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Block Withholding Attack | DarkSharpness's Dungeon</title><meta name="author" content="DarkSharpness"><meta name="copyright" content="DarkSharpness"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="Introduction to Block Withholding Attack in PoW Blockchain.">
<meta property="og:type" content="article">
<meta property="og:title" content="Block Withholding Attack">
<meta property="og:url" content="http://darksharpness.github.io/blockwithhold/index.html">
<meta property="og:site_name" content="DarkSharpness&#39;s Dungeon">
<meta property="og:description" content="Introduction to Block Withholding Attack in PoW Blockchain.">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2025/06/04/56a990d5e50ecb5d.jpg">
<meta property="article:published_time" content="2025-05-26T06:47:33.000Z">
<meta property="article:modified_time" content="2025-06-04T06:37:54.438Z">
<meta property="article:author" content="DarkSharpness">
<meta property="article:tag" content="作业">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s3.bmp.ovh/imgs/2025/06/04/56a990d5e50ecb5d.jpg"><link rel="shortcut icon" href="https://s2.loli.net/2023/01/28/SnEi2v9sdczUuyG.png"><link rel="canonical" href="http://darksharpness.github.io/blockwithhold/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')
          
          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":1000,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Block Withholding Attack',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><link rel="stylesheet" href="/css/user.css"><link rel="stylesheet" href="/css/font.css"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="DarkSharpness's Dungeon" type="application/atom+xml">
</head><body><div id="web_bg" style="background: black;"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2023/01/28/SnEi2v9sdczUuyG.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">35</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">24</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">25</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-ellipsis-h"></i><span> 杂物</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/photo/"><i class="fa-fw fas fa-image"></i><span> 图床</span></a></li><li><a class="site-page child" href="/diary/"><i class="fa-fw fas fa-book"></i><span> 日记</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://s3.bmp.ovh/imgs/2025/06/04/56a990d5e50ecb5d.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2023/01/28/SnEi2v9sdczUuyG.png" alt="Logo"><span class="site-name">DarkSharpness's Dungeon</span></a><a class="nav-page-title" href="/"><span class="site-name">Block Withholding Attack</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-ellipsis-h"></i><span> 杂物</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/photo/"><i class="fa-fw fas fa-image"></i><span> 图床</span></a></li><li><a class="site-page child" href="/diary/"><i class="fa-fw fas fa-book"></i><span> 日记</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Block Withholding Attack</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-05-26T06:47:33.000Z" title="发表于 2025-05-26 14:47:33">2025-05-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-06-04T06:37:54.438Z" title="更新于 2025-06-04 14:37:54">2025-06-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/">计算机</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E5%8C%BA%E5%9D%97%E9%93%BE/">区块链</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">2.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>17分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>Disclaimer: All the image in this post is uploaded to <a target="_blank" rel="noopener" href="https://sm.ms/">sm.ms</a>, which may not be friendly to readers in mainland China.</p>
<h2 id="PoW-Mining-Model"><a href="#PoW-Mining-Model" class="headerlink" title="PoW Mining Model"></a>PoW Mining Model</h2><p>As we all know (?), in PoW (proof of work) blockchain system, miners can mine blocks to gain block reward (bitcoins). Mining blocks requires the miner to prove that they have done a certain amount of work. The most common proof of work is to find a hash that satisfy certain properties. For example, the hash value of a string in integer is no larger than a certain number $N$. Assume the range of the output of hash is $R$, then the probability of a random hash to be valid will be $\frac{N}{R}$.Due to the nature of cryptography secure hash functions, the distribution of output hash is unpredictable given any different strings as input, which means we may assume that the probability of any string to has a valid hash is $\frac{N}{R}$. Note that there can be other means of constrains for a block to be valid, but the core is simple: the probability of a hash to be valid will be $p$, which is typically a small number.</p>
<p>Let’s take a look at a well-known real-world example: Bit-Coin. In Bit-Coin, the threshold $N$ is related to <strong>difficulty</strong>. Trivially, the higher the difficulty is, the lower the threshold will be. This is threshold is adjusted dynamically by the system in response to the overall computing power in the Bit-Coin mining system. It’s public to all and can’t be configured manually. This is not the core of this blog post, so we will skip on this.</p>
<!--

## Mining Pool

Now, the problem is clear: as a miner, you want to be make money by mining Bit-Coin. However, if you mine alone (called solo miner), the variance of finding a block is large, which means higher risks.

In Bit-Coin, the difficulty is adjusted to ensure that every new block will be found in around $T = 10$ minutes. Suppose the hash compute power of you is $h$, and the overall compute power in Bit-Coin mining is $H$, then in expectation you will find a valid block in $\frac{H}{h} \times T$ minutes. Since the probability of finding a block is the same at any time, the probability distribution adheres to possion distribution. As a result, the probability density function that the player find a block at $t$ is $F(t) = \lambda e ^{\lambda t}$. Note that $\mathbb{E}(tF) = \frac{1}{\lambda}$, so we have $\lambda = \frac{HT}{h}$, the variance of a solo miner is $\text{Var}(F) = \lambda = \frac{HT}{h} \propto \frac{H}{h}$

That would be too big and thereby risky for a personal miner, as the proportion of personal hash power is rather small. For example, $H$ is around $800 \text{EH/s}$. $\text{EH/s}$ is a unit which stands for $10^{18}$ hash operation per second. For a personal computer's GPU (e.g. RTX 3090), the hash power $h$ is around $100 {MH/s}$, which is magnitudes smaller than $H$. For some designated hash machines, the $h$ is around $100 {TH/s}$, still much slower than $H$.

-->
<h2 id="Why-do-we-need-a-mining-pool"><a href="#Why-do-we-need-a-mining-pool" class="headerlink" title="Why do we need a mining pool?"></a>Why do we need a mining pool?</h2><p>In short, Bitcoin’s security relies on proof-of-work: miners construct block headers (including a nonce and transactions) and hash them with SHA-256. A block is valid if its hash is below a global difficulty target (equivalently, starts with $z$ leading zero bits). Finding such a hash is probabilistic and computationally intensive. A solo miner with fraction $\alpha$ of the network’s total hash power will on average mine $\alpha$ fraction of the blocks over time.</p>
<p>Since the difficulty of Bitcoin is dynamically adjusted to maintain an average block interval of around $T = 10 \text{min}$, a solo miner finds a block every $\frac{T}{\alpha}$ on average.</p>
<p>As finding a valid hash (i.e. starts with $z$ leading zero bits) is random, we may assume the probability density function of finding the first block at time $t$ is modeled by exponential distribution $f(t)$.</p>
<p>Suppose $f(t) = \lambda e^{-\lambda t}$. Since $\mathbb{E}(t) = \frac{T}{\alpha}$, we have $\lambda = \frac{\alpha}{T}$.</p>
<ul>
<li>The variance of $f$ is $\sigma(f) = \frac{1}{\lambda} = \frac{T}{\alpha}$</li>
</ul>
<p>However, $\frac{T}{\alpha}$ may be prohibitively large for solo miners. Currently, the overall computation power in Bitcoin mining has reach around $800\text{EH/s}$, which is $8 \times 10^{20}$ hash per second. For a 3090, a common GPU for personal computer, the peak hash power is less than $200\text{MH/s}$, which is $2 \times 10^{8}$. Even for designated ASIC hash machines, their peak hash power can only reach $1000\text{TH/s}$, which is $1 \times 10^{15}$, still orders of magnitude lower.</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2025/05/26/d5JmjM17oxPA36D.png" alt="SOTA Miner"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2025/06/04/Qqmw9LkdEtloP8H.png" alt="Computation Power"></p>
<h2 id="What-is-a-mining-pool"><a href="#What-is-a-mining-pool" class="headerlink" title="What is a mining pool?"></a>What is a mining pool?</h2><p>While $\frac{T}{\alpha}$ can correspond to years — or even decades — for a solo miner, this level of delay is typically infeasible. A practical solution to mitigate such high variance (and the associated financial risk) is the mining pool.</p>
<p>In a mining pool, coordinated by a pool operator, each miner performs a share of the total computational. Although only one block will be valid in a round, and only that valid block will make a profit, the miner will evenly distribute the reward $R$ of block to each miner, judged by each one’s contribution.</p>
<p>The rationale is intuitive: the more work a miner contributes, the more reward they receive. More importantly, participating in a pool significantly reduces the variance in individual earnings - a point we will analyze in more detail two slides later.</p>
<p>In real-world, it’s infeasible for a mining pool to distribute its income by each one’s real work: it would take equal time to verify the miners submit a nonce with its corresponding hash value.</p>
<p>To address this, miners do not submit every hash they compute. Instead, similar to Bitcoin’s global difficulty mechanism, miners submit selected (nonce, hash) pairs - known as shares, that satisfy:</p>
<ul>
<li>Correctness: $H$(nonce + transaction) = hash</li>
<li>Difficulty’: hash starts with $z’$ zeros.</li>
</ul>
<p>The value of $z’$ is determined by the pool operator and satisfies $0 \le z’ \le z$, where $z$ is the global difficulty. A lower $z’$ allows miners to find shares more frequently, while a higher $z’$ reduces verification overhead for the pool. Pool operators thus choose $z’$ to strike a balance between efficient mining and manageable validation cost.</p>
<p>So why is the variance reduced? Because the effective difficulty for submitting shares is significantly lower. As a result, miners can find valid shares more frequently. The new expected time to submit a share becomes: $\frac{T}{\alpha} \times 2^{z’ - z}$.</p>
<p>In practice, mining pools also incur additional overhead. For example, verifying (nonce, hash) pairs requires computational resources, and maintaining the pool server infrastructure adds operational cost. To cover these, pool operators typically take a small portion of the block reward $R$. As a result, the miner’s expected reward per block may be reduced to $\lambda_1 R$ where $0 \le \lambda_1 \le 1$.</p>
<p>Ultimately, this creates a trade-off: miners gain more stable and predictable returns (lower variance), but at the cost of slightly lower expected rewards. To fight alone or along, which is the right way…</p>
<p>Next, we will discuss block withholding attack (BWH) on mining pool.</p>
<h2 id="Why-there-are-Block-Withholding-attacks"><a href="#Why-there-are-Block-Withholding-attacks" class="headerlink" title="Why there are Block Withholding attacks?"></a>Why there are Block Withholding attacks?</h2><p>Not all the miners are honest. Some selfish people may think: Why do I need to submit a valid block to the pool operator? As the reward now is only judged by shares that one submits, one can refuse to submit shares that can be a valid block.</p>
<p>Although this seems to reduce the average reward per time unit for that miner, the malicious miner may have some compute hash power outside, which may take advantage. In other words, the hash power of a malicious miner can be divided into 2 (and even more) parts: one for dishonest mining, one for mining in other pools or solely. The second part may benefit from undermining the first part.</p>
<p>As long as the gain from sabotage &gt; loss of withheld rewards, a rational (but selfish) miner may choose to attack.</p>
<p>Even worse, some mining pools may deliberately encourage such malicious behavior. Since undermining other pools can bring competitive advantages, these evil pools may choose to reward attackers who successfully perform block withholding attacks against their rivals.</p>
<p>To prove the attack, a malicious miner only needs to show evidence that they found a valid block while mining for another pool, but intentionally withheld it. For example, they can submit the nonce and corresponding hash of that valid block to the sponsoring pool.</p>
<p>This strategy is known as a sponsored withholding attack. It significantly worsens the problem, turning individual dishonesty into a systemic threat, and may incentivize more miners to engage in block withholding for profit.</p>
<p>Now, we will prove that BWH may indeed benefit the 3rd-party, and how malicious can benefit from that.</p>
<h2 id="What-benefit-does-BWH-bring"><a href="#What-benefit-does-BWH-bring" class="headerlink" title="What benefit does BWH bring?"></a>What benefit does BWH bring?</h2><p>For simplicity, suppose there are only $3$ organizations: 2 public pools and 1 sole miner. The hash power fraction of first pool is $p$, and the hash power fraction of second pool is $p’$. The sole miner’s fraction is $\alpha$ and we have $p + p’ + \alpha = 1$.</p>
<p>Suppose the reward proportion distributed to each from a single pool is $\lambda_1$, which means the pool will keep $1 - \lambda_1$ of the block reward. Suppose reward $R = 1$.</p>
<p>We assume the sole miner is malicious, and $\beta$ of his hash power is used for attacking the first pool, which is $\alpha \times \beta$.</p>
<h3 id="Gains-of-the-3rd-party"><a href="#Gains-of-the-3rd-party" class="headerlink" title="Gains of the 3rd party"></a>Gains of the 3rd party</h3><p>First, we will show that BWH can benefit the 3rd-party.</p>
<p>Without any attack, the gain rate of the second pool is $\frac{p’}{1} = p$. After BWH, the effective overall hash power decreases to $1 - \alpha\beta$, so the new gain rate rises to $\frac{p’}{1 - \alpha\beta}$, with an increase of $\frac{\alpha \beta}{1 - \alpha\beta}p’$.</p>
<p>Similarly, we can define a similar “reward” proportion for attacking on another pool as $\lambda_2$.</p>
<h3 id="Gains-of-the-attacker"><a href="#Gains-of-the-attacker" class="headerlink" title="Gains of the attacker"></a>Gains of the attacker</h3><p>We assume attacker seeks maximum profit.</p>
<p>After joining the first pool, his work proportion is $\frac{\alpha\beta}{p + \alpha\beta}$, but the effective hash power of the first pool is still $p$ alone, as the malicious miner won’t submit any valid blocks. Therefore, he will in all gain $\lambda_1 \frac{\alpha\beta}{p + \alpha\beta} \frac{p}{1 - \alpha\beta}$ from the first pool.</p>
<p>Since he wants to maximize his profit, he won’t invest his money in other pools (otherwise, $1 - \lambda_1$ proportion will be taken away). He will use all his remaining $\alpha(1 - \beta)$ to mine solely. As a result, he will gain $\frac{\alpha(1 - \beta)}{1 - \alpha\beta}$ from that.</p>
<p>Finally, he will gain $\lambda_2 \frac{\alpha \beta}{1 - \alpha\beta}p’$ as the reward for betrayal.</p>
<p>In short, the overall gain of the attacker is:</p>
<script type="math/tex; mode=display">
\begin{aligned}
G' = ~ & \lambda_1 \frac{\alpha\beta}{p + \alpha\beta} \frac{p}{1 - \alpha\beta} + \frac{\alpha(1 - \beta)}{1 - \alpha\beta} + \lambda_2 \frac{\alpha \beta}{1 - \alpha\beta}p' \\
= ~ & \frac{\alpha}{1 - \alpha\beta}(\lambda_1 \frac{\beta p}{p + \alpha \beta} + 1 - \beta + \lambda_2 \beta (1 - p - \alpha))
\end{aligned}</script><p>The extra gain is:</p>
<script type="math/tex; mode=display">
\Delta G = G' - \alpha = \frac{\alpha\beta}{1 - \alpha\beta}(\lambda_1 \frac{p}{p + \alpha \beta} + \alpha - 1 + \lambda_2 (1 - p - \alpha))</script><p>As long as the following formula holds true, the selfish miner can make a profit from the attack.</p>
<script type="math/tex; mode=display">
\lambda_1 \frac{p}{p + \alpha \beta} + \alpha - 1 + \lambda_2 (1 - p - \alpha) > 0</script><p>which can be written in an informative form:</p>
<script type="math/tex; mode=display">
\begin{aligned}
\frac{\alpha\beta}{p}
& < \frac{\lambda_1 + \lambda_2 (1 - p - \alpha) - (1 - \alpha)}{1 -\alpha - \lambda_2(1 - p - \alpha)} \\
& = \frac{\lambda_1}{1 -\alpha - \lambda_2(1 - p - \alpha)} - 1 \\
\end{aligned}</script><p>We will discuss the following formula in some special cases:</p>
<h3 id="Genuine-Bad-Guy"><a href="#Genuine-Bad-Guy" class="headerlink" title="Genuine Bad Guy"></a>Genuine Bad Guy</h3><p>$\lambda_2 \to 1$</p>
<p>In this case, as long as $\alpha \beta + p &lt; \lambda_1$, the attacker can benefit. Since $\lambda_1$ is close to $1$, this will always hold.</p>
<h3 id="No-sponsorship"><a href="#No-sponsorship" class="headerlink" title="No sponsorship"></a>No sponsorship</h3><p>$\lambda_2 \to 0$</p>
<p>In this case, we need $\frac{\alpha\beta}{p} &lt; \frac{\lambda_1}{1 - \alpha} - 1$. If $\alpha \le 1 - \lambda_1$, then it’s impossible for the miner to benefit from BWH.</p>
<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>In short, the more incentive (larger $\lambda_2$), the more beneficial the attack is.</p>
<p>Here are some figures: (y-axis is $\dfrac{\Delta G}{\alpha}$)</p>
<div class="gallery-container" data-type="data" data-button="">
      <div class="gallery-items">[{"url":"https://s2.loli.net/2025/06/04/gMYBjUe4Jw1kWXp.png","alt":"image.png"},{"url":"https://s2.loli.net/2025/06/04/DlKb6IRtL7rmhPF.png","alt":"image.png"},{"url":"https://s2.loli.net/2025/06/04/jBM65zhPHxVQblp.png","alt":"image.png"}]</div>
    </div>
<p>$\lambda_1 = 1, p = 0.2, \alpha=0.02$, where $\lambda_2 = 0, 0.2, 1$</p>
<div class="gallery-container" data-type="data" data-button="">
      <div class="gallery-items">[{"url":"https://s2.loli.net/2025/06/04/ArFgDkTjPUOL4wW.png","alt":"image.png"},{"url":"https://s2.loli.net/2025/06/04/ArFgDkTjPUOL4wW.png","alt":"image.png"},{"url":"https://s2.loli.net/2025/06/04/yCjziIHSvZBm12k.png","alt":"image.png"}]</div>
    </div>
<p>$\lambda_1 = 0.9, p = 0.2, \alpha=0.02$, where $\lambda_2 = 0, 0.2, 0.9$</p>
<h3 id="Better-attack-strategy"><a href="#Better-attack-strategy" class="headerlink" title="Better attack strategy"></a>Better attack strategy</h3><p>In fact, the miner may attack several pools. Consider $\frac{\Delta G}{\alpha\beta}$. Let $\gamma = \alpha\beta$, then we have:</p>
<script type="math/tex; mode=display">
\frac{\Delta G}{\alpha\beta} =  \frac{1}{1 - \gamma}(\lambda_1 \frac{p}{p + \gamma} - c), c \in [p, 1 - \alpha]</script><p>This function is always descending with respect to $\gamma$, so the best strategy of a selfish miner is to split his attack across different mining pools. That is, he can attack not only the first pool but even the second pool, which rewarded him to attack the first pool. And the theoretical upper bound of his attack is</p>
<script type="math/tex; mode=display">
\lambda_1 + \lambda_2 (1 - p - \alpha) - (1 - \alpha)</script><p>exactly when $\beta \to 0$.</p>
<div class="gallery-container" data-type="data" data-button="">
      <div class="gallery-items">[{"url":"https://s2.loli.net/2025/06/04/f8ICuD13mVkTLXb.png","alt":"image.png"},{"url":"https://s2.loli.net/2025/06/04/AZfBSoROmD1h3KN.png","alt":"image.png"},{"url":"https://s2.loli.net/2025/06/04/kKCcaQvm2BW7jXt.png","alt":"image.png"}]</div>
    </div>
<p>$\lambda_1 = 0.9, p = 0.2, \alpha=0.02$, where $\lambda_2 = 0, 0.2, 0.9$. y-axis is $\dfrac{\Delta G}{\alpha \beta}$.</p>
<h2 id="Possible-Consequence-of-BWH"><a href="#Possible-Consequence-of-BWH" class="headerlink" title="Possible Consequence of BWH"></a>Possible Consequence of BWH</h2><p>These dynamics create a “pool game”. If a pool $P$ is attacked, its miners’ revenue density falls. Rational miners might then leave $P$ for more profitable pools, further weakening $P$. If $P’$ gains (and pays the attacker), $P’$’s miners see higher revenue density. In equilibrium, pools could be tricked to attack others to gain an advantage, potentially leading to a “race to the bottom” where all pools lose.</p>
<p>Imagine there are multiple attacks between pools, it will result in a sharp decline in effective hash power: much of them are wasted in BWH.</p>
<p>Thus, BWH (classical or sponsored) undermines pool stability and Bitcoin stability: it can drive small pools out of business and cause mining resources to concentrate.</p>
<h2 id="How-to-defend-against-BWH"><a href="#How-to-defend-against-BWH" class="headerlink" title="How to defend against BWH?"></a>How to defend against BWH?</h2><p>How to defend against BWH? The key insight is that: every miner could easily tell between a valid block and a normal share. As a result, they have the freedom not to submit those valid blocks, which may potentially harm those honest miners.</p>
<p>To fundamentally solve the issue, we should come up with cryptographic methods that guarantee the miner couldn’t tell between a valid block and a normal share. In this way, a miner who withholds any hash would not know if she was giving up a block or just an ordinary share, and he can’t selectively submit those non-block shares, which will stop BWH.</p>
<h3 id="Method-01"><a href="#Method-01" class="headerlink" title="Method-01"></a>Method-01</h3><p>In the paper “Bitcoin Block Withholding Attack: Analysis and Mitigation”, the following approach is proposed:</p>
<ol>
<li>The mining pool find a random string $r \in {0,1}^{z - z’}$ and another random string $s \in {0,1}^*$. Let $p = H(r || s)$</li>
<li>Both $z’$ and $p$ is made public. Note that the protocol of Bitcoin needs to be changed in this case, as part of the header.</li>
<li>The pool receives pool shares (partial proofs) from miners that its hash starts with $z’$ zeros.</li>
<li>In the new protocol, a block is valid if it starts with $z’$ zeros, followed by a new nonce $r$. So a pool operator just need to check whether the next $z - z’$ bits of is $r$.</li>
</ol>
<p>The approach above is as difficult as the old approach. Since the special nonce $r$ is sealed into $p$, which will be used in computing hash, it’s impossible to cheat by finding $r$ faster than brute force where:</p>
<script type="math/tex; mode=display">H(\cdots H(r||s) \cdots n \cdots) = 0^{z'} || r || \{0,1\}^{256 - z}</script><p>Consequently, the target is quite similar: for a fixed $r$, find some nonce $n$ such that its prefix $z’ + z - z’ = z$ bits are fixed as $0^{z’} || r$. The key insight of this approach is that miners can’t find the $r$, so they can’t tell between shares and valid blocks. The verification of a block can be done by a pool operator.</p>
<p>Sadly, this approach requires modification of the protocol of Bitcoin.</p>
<h3 id="Method-02"><a href="#Method-02" class="headerlink" title="Method-02"></a>Method-02</h3><p>Let’s review the process of block withholding attack. How Can we directly detect that? A prominent feature of BWH is that: one never submits valid blocks. So, a naive idea is that: we reward those valid blocks. This is a naive fusion of mining pool and sole mining.</p>
<p>As long as submitting a valid block to the pool is more profitable than to its rival, a greedy miner will do the right thing.</p>
<p>We will introduce a potential workaround for BWH in the next slide.</p>
<p>Suppose the reward ratio for a non-block share is $\lambda_3$, the share-block ratio is $\mu = 2 ^{z - z’} &gt; 1$, and the block reward ratio is $\lambda_4$. Assume the pool operator keeps the same proportion as before, then we have:</p>
<script type="math/tex; mode=display">
\frac{1}{\mu} ((\mu - 1) \cdot \lambda_3 + 1 \cdot \lambda_4) = \lambda_1</script><p>We can then let $\lambda_3 = \lambda_1 - \delta, \lambda_4 = \lambda_1 + (\mu - 1) \delta$.</p>
<p>The effective $\lambda_1$ now drops to $\lambda_3 = \lambda_1 - \delta$.\</p>
<p>Note that this is not a free lunch. As $\delta$ grows larger, it will degenerate to sole mining, which means the variance will also grow larger and unacceptable. It’s yet another trade-off.</p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E4%BD%9C%E4%B8%9A/">作业</a></div><div class="post-share"><div class="social-share" data-image="https://s3.bmp.ovh/imgs/2025/06/04/56a990d5e50ecb5d.jpg" data-sites="facebook,twitter,wechat,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://vdse.bdstatic.com//192d9a98d782d9c74c96f09db9378d93.mp4" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2023/02/17/bNFrOglBCW6ZaUq.png" alt="Wechat"/></a><div class="post-qr-code-desc">Wechat</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/env-2/" title="My environment config v2.0"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2025/06/27/MW5js87vLXJgklo.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">My environment config v2.0</div></div><div class="info-2"><div class="info-item-1">I hate configuring environment.</div></div></div></a><a class="pagination-related" href="/env-shell/" title="My Windows Terminal Configuration"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s3.bmp.ovh/imgs/2024/01/19/1d88e2436576d55c.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">My Windows Terminal Configuration</div></div><div class="info-2"><div class="info-item-1">This is the first time I write my BLOG in English.</div></div></div></a></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2023/01/28/SnEi2v9sdczUuyG.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">DarkSharpness</div><div class="author-info-description">逸一时，误一世!</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">35</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">24</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">25</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/DarkSharpness" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://space.bilibili.com/396961987" target="_blank" title="Bilibili"><i class="iconfont icon-bilibili"></i></a><a class="social-icon" href="https://www.zhihu.com/people/darksharpness" target="_blank" title="Zhihu"><i class="iconfont icon-zhihu"></i></a><a class="social-icon" href="https://music.163.com/#/user/home?id=8335592513" target="_blank" title="Cloudmusic"><i class="fa-solid fa-music"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">we will go certainly, till the end !</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#PoW-Mining-Model"><span class="toc-number">1.</span> <span class="toc-text">PoW Mining Model</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Why-do-we-need-a-mining-pool"><span class="toc-number">2.</span> <span class="toc-text">Why do we need a mining pool?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#What-is-a-mining-pool"><span class="toc-number">3.</span> <span class="toc-text">What is a mining pool?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Why-there-are-Block-Withholding-attacks"><span class="toc-number">4.</span> <span class="toc-text">Why there are Block Withholding attacks?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#What-benefit-does-BWH-bring"><span class="toc-number">5.</span> <span class="toc-text">What benefit does BWH bring?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Gains-of-the-3rd-party"><span class="toc-number">5.1.</span> <span class="toc-text">Gains of the 3rd party</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Gains-of-the-attacker"><span class="toc-number">5.2.</span> <span class="toc-text">Gains of the attacker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Genuine-Bad-Guy"><span class="toc-number">5.3.</span> <span class="toc-text">Genuine Bad Guy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#No-sponsorship"><span class="toc-number">5.4.</span> <span class="toc-text">No sponsorship</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Conclusion"><span class="toc-number">5.5.</span> <span class="toc-text">Conclusion</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Better-attack-strategy"><span class="toc-number">5.6.</span> <span class="toc-text">Better attack strategy</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Possible-Consequence-of-BWH"><span class="toc-number">6.</span> <span class="toc-text">Possible Consequence of BWH</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#How-to-defend-against-BWH"><span class="toc-number">7.</span> <span class="toc-text">How to defend against BWH?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Method-01"><span class="toc-number">7.1.</span> <span class="toc-text">Method-01</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Method-02"><span class="toc-number">7.2.</span> <span class="toc-text">Method-02</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/env-2/" title="My environment config v2.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2025/06/27/MW5js87vLXJgklo.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="My environment config v2.0"/></a><div class="content"><a class="title" href="/env-2/" title="My environment config v2.0">My environment config v2.0</a><time datetime="2025-06-23T08:38:25.000Z" title="发表于 2025-06-23 16:38:25">2025-06-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/blockwithhold/" title="Block Withholding Attack"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s3.bmp.ovh/imgs/2025/06/04/56a990d5e50ecb5d.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Block Withholding Attack"/></a><div class="content"><a class="title" href="/blockwithhold/" title="Block Withholding Attack">Block Withholding Attack</a><time datetime="2025-05-26T06:47:33.000Z" title="发表于 2025-05-26 14:47:33">2025-05-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/env-shell/" title="My Windows Terminal Configuration"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s3.bmp.ovh/imgs/2024/01/19/1d88e2436576d55c.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="My Windows Terminal Configuration"/></a><div class="content"><a class="title" href="/env-shell/" title="My Windows Terminal Configuration">My Windows Terminal Configuration</a><time datetime="2025-05-02T09:22:43.000Z" title="发表于 2025-05-02 17:22:43">2025-05-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/cppModern/" title="Effective Modern C++"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s3.bmp.ovh/imgs/2025/04/07/52e46b1c151e1b77.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Effective Modern C++"/></a><div class="content"><a class="title" href="/cppModern/" title="Effective Modern C++">Effective Modern C++</a><time datetime="2025-04-07T01:42:39.000Z" title="发表于 2025-04-07 09:42:39">2025-04-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/torch/" title="dispatcher is all you need"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s3.bmp.ovh/imgs/2024/11/27/3e28dd3239526ce1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="dispatcher is all you need"/></a><div class="content"><a class="title" href="/torch/" title="dispatcher is all you need">dispatcher is all you need</a><time datetime="2024-11-26T18:08:43.000Z" title="发表于 2024-11-27 02:08:43">2024-11-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/misc/" title="杂七杂八的东西 - 大三上小结"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://static.zerochan.net/Hatsune.Miku.full.1661213.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="杂七杂八的东西 - 大三上小结"/></a><div class="content"><a class="title" href="/misc/" title="杂七杂八的东西 - 大三上小结">杂七杂八的东西 - 大三上小结</a><time datetime="2024-11-04T09:10:49.000Z" title="发表于 2024-11-04 17:10:49">2024-11-04</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2025 By DarkSharpness</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">DarkSharpness welcomes you!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button id="blur_toggle" type="button" title="切换背景模糊"><i class="fas fa-cloud"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'none',
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }
      
      const script = document.createElement('script')
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo
  const option = null

  const getGiscusTheme = theme => theme === 'dark' ? 'dark' : 'light'

  const createScriptElement = config => {
    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => {
      ele.setAttribute(key, value)
    })
    return ele
  }

  const loadGiscus = (el = document, key) => {
    const mappingConfig = isShuoshuo
      ? { 'data-mapping': 'specific', 'data-term': key }
      : { 'data-mapping': (option && option['data-mapping']) || 'pathname' }

    const giscusConfig = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'DarkSharpness/DarkSharpness.github.io',
      'data-repo-id': 'MDEwOlJlcG9zaXRvcnkzNDE1Nzc5NDY=',
      'data-category-id': 'DIC_kwDOFFwQ2s4CT2jG',
      'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
      'data-reactions-enabled': '1',
      crossorigin: 'anonymous',
      async: true,
      ...option,
      ...mappingConfig
    }

    const scriptElement = createScriptElement(giscusConfig)

    el.querySelector('#giscus-wrap').appendChild(scriptElement)

    if (isShuoshuo) {
      window.shuoshuoComment.destroyGiscus = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const changeGiscusTheme = theme => {
    const iframe = document.querySelector('#giscus-wrap iframe')
    if (iframe) {
      const message = {
        giscus: {
          setConfig: {
            theme: getGiscusTheme(theme)
          }
        }
      }
      iframe.contentWindow.postMessage(message, 'https://giscus.app')
    }
  }

  btf.addGlobalFn('themeChange', changeGiscusTheme, 'giscus')

  if (isShuoshuo) {
    'Giscus' === 'Giscus'
      ? window.shuoshuoComment = { loadComment: loadGiscus }
      : window.loadOtherComment = loadGiscus
    return
  }

  if ('Giscus' === 'Giscus' || !true) {
    if (true) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
    else loadGiscus()
  } else {
    window.loadOtherComment = loadGiscus
  }
})()</script></div><script src="/js/meting.min.js"></script><script src="/js/user.js"></script><div class="aplayer no-destroy" data-volume="0.1" data-id="8149615949" data-autoplay="false" data-server="netease" data-type="playlist" data-loop="all" data-order="random" data-fixed="true" mutex="true"> </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["link[rel=\"canonical\"]","meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      pjax.loadUrl('/404.html')
    }
  })
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>